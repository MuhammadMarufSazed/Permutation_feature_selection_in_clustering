---
title: "Untitled"
author: "Muhammad Maruf Sazed"
date: "01/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(rlist)
library(clustvarsel)
library(vscc)
#library(purrr)
sim_data = list()

shuffle_fn <- function(data, permute_no){
  n = nrow(data)
  d = ncol(data)
  shuff_data = array(NA, dim = c(d, permute_no, n, d))
  for (i in 1:d){
    for (perm in 1:permute_no){
      s_data = cbind(data[ , -i], sample(data[,i]))
      shuff_data[ i, perm, , ] = s_data
    } 
  }
  return(shuff_data)
}

mclust_fn <- function(data, G = 2, verbose = FALSE){
  mod_clust = Mclust(data, G = G)
  return(mod_clust$loglik)
}

kmeans_fn <- function(data, G = 2){
  mod = kmeans(data, centers = G)
  return(mod$tot.withinss)
}
```


```{r DataPrep_Sim1}
#Sim1: Raftery_Simulation_First_Case

n <- 500      # sample size
pro <- 0.5    # mixing proportion
mu1 <- c(0,0) # mean vector for the first cluster
mu2 <- c(4,2) # mean vector for the second cluster
sigma1 <- matrix(c(1, -0.5, -0.5,1),2,2)       # covar matrix for the first cluster
sigma2 <- matrix(c(2, .5, .5,2),2,2) # covar matrix for the second cluster
X <- matrix(0, n, 7, dimnames = list(NULL, paste0("X", 1:7)))
set.seed(1234) # for replication
u <- runif(n)
Class <- ifelse(u < pro, 1, 2)

X[u < pro, 1:2]  <- MASS::mvrnorm(sum(u < pro), mu = mu1, Sigma = sigma1)
X[u >= pro, 1:2] <- MASS::mvrnorm(sum(u >= pro), mu = mu2, Sigma = sigma2)
X[, 3] <- rnorm(n)
X[, 4] <- rnorm(n, mean = 1.5, sd = 2)
X[, 5] <- rnorm(n, mean = 2, sd = 1)
X[, 6] <- rnorm(n, mean = 3, sd = 4.5)
X[, 7] <- rnorm(n, mean = -1, sd = 2.5)

plot(X[,c(1,2)], col = Class, pch = 19, main = "Important variables (X1 and X2)")
pairs(X, col = ifelse(Class == 1, "chartreuse2", "blue4"), pch = 19)

# sim1 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim1.rds")
# out = sim1 [[1]]
# mod_vscc = sim1 [[2]]
# permuted_data = sim1[[3]]
# permute_ob_mclust = sim1[[4]]
# permute_ob_km = sim1[[5]]

#sim_data = list.append(sim_data, X)

#Variable selection Clustvarsel
out <- clustvarsel(X, G = 2)
# out$subset
# tab = as.data.frame(prop.table(table(Class, out$model$classification)))
# colnames(tab)[2] = "Group_Assigned"

#Variable selection VSCC
mod_vscc = vscc(X, G=2, automate = "mclust", initial = NULL, train = NULL, forcereduction = FALSE)
# colnames(head(mod_vscc$selected[[1]]))
# mod_vscc$bestmodel$d
# tab_vscc = as.data.frame(prop.table(table(Class, mod_vscc$bestmodel$classification)))


#Permutation feature selection 
permuted_data  =  shuffle_fn(X, 50)
permute_ob_mclust = apply(permuted_data, 1, function(a){apply(a, 1, mclust_fn)})
permute_ob_km = apply(permuted_data, 1, function(a){apply(a, 1, kmeans_fn)})

apply(permute_ob_fn, 2, mean)
plot(apply(permute_ob_fn, 2, mean), main = "Mean likelihood after permutations for each variable")


saveRDS(list(out, mod_vscc, permuted_data, permute_ob_mclust, permute_ob_km), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim1.rds")



```



```{r DataPrep_Sim2}
# Sim2: Raftery_Simulation_second

n <- 500      # sample size
pro <- 0.5    # mixing proportion
mu1 <- c(0,0) # mean vector for the first cluster
mu2 <- c(4,2) # mean vector for the second cluster
sigma1 <- matrix(c(1, -0.5, -0.5,1),2,2)       # covar matrix for the first cluster
sigma2 <- matrix(c(2, .5, .5,2),2,2) # covar matrix for the second cluster
X <- matrix(0, n, 15, dimnames = list(NULL, paste0("X", 1:15)))
set.seed(1234) # for replication
u <- runif(n)
Class <- ifelse(u < pro, 1, 2) #Class information

#Important variables
X[u < pro, 1:2]  <- MASS::mvrnorm(sum(u < pro), mu = mu1, Sigma = sigma1) #Main variable 1
X[u >= pro, 1:2] <- MASS::mvrnorm(sum(u >= pro), mu = mu2, Sigma = sigma2) #Main variable 2

#Irrelevant variables
X[, 3] <- rnorm(n)
X[, 4] <- rnorm(n, mean = 1.5, sd = 2)
X[, 5] <- rnorm(n, mean = 2, sd = 1)

#Linear combincations of irrelevant variabls
X[, 6] <- X[, 3] + rnorm(n, mean = 3, sd = 4.5)
X[, 7] <- X[, 4] + rnorm(n, mean = -1, sd = 2.5)
X[, 8] <- X[, 5] + rnorm(n, mean = -1, sd = 2.5)
X[, 9] <- X[, 3] + X[, 4] + rnorm(n, mean = -1, sd = 2.5) 
X[, 10] <- X[, 3] + X[, 5] + rnorm(n, mean = -1, sd = 2.5)
X[, 11] <- X[, 4] + X[, 5] + rnorm(n, mean = -1, sd = 2.5)
X[, 12] <- X[, 3] + X[, 4] + X[, 4] + rnorm(n, mean = -1, sd = 2.5)

#Linear combincations of important variabls
X[, 13] <- X[,1] + rnorm(n)
X[, 14] <- X[,2] + rnorm(n)
X[, 15] <- X[,1] + X[,2] + rnorm(n)

plot(X[,c(1,2)], col = Class, pch = 19, main = "Important variables (X1 and X2)")

#sim_data = list.append(sim_data, X)

# sim2 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim2.rds")
# out = sim2 [[1]]
# mod_vscc = sim2[[2]]
# permuted_data = sim2[[3]]
# permute_ob_mclust = sim2[[4]]
# permute_ob_km = sim2[[5]]

#Variable selection Clustvarsel
out <- clustvarsel(X, G = 2)
# out$subset
# tab = as.data.frame(prop.table(table(Class, out$model$classification)))
# colnames(tab)[2] = "Group_Assigned"


#Variable selection VSCC
mod_vscc = vscc(X, G=2, automate = "mclust", initial = NULL, train = NULL, forcereduction = FALSE)
# colnames(head(mod_vscc$selected[[1]]))
# mod_vscc$bestmodel$d
# tab_vscc = as.data.frame(prop.table(table(Class, mod_vscc$bestmodel$classification)))


#Permutation feature selection 
permuted_data  =  shuffle_fn(X, 50)
permute_ob_mclust = apply(permuted_data, 1, function(a){apply(a, 1, mclust_fn)})
permute_ob_km = apply(permuted_data, 1, function(a){apply(a, 1, kmeans_fn)})

apply(permute_ob_fn, 2, mean)
plot(apply(permute_ob_fn, 2, mean), main = "Mean likelihood after permutations for each variable")


saveRDS(list(out, mod_vscc, permuted_data, permute_ob_mclust, permute_ob_km), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim2.rds")




```


```{r DataPrep_Sim3}
#Sim3: Raftery_Simulation_second_modified (introducing two clusters along an irrelevant feature)
#Will not include that

n <- 200      # sample size
pro <- 0.5    # mixing proportion
mu1 <- c(0,0) # mean vector for the first cluster
mu2 <- c(4,2) # mean vector for the second cluster
sigma1 <- matrix(c(1, -0.5, -0.5,1),2,2)       # covar matrix for the first cluster
sigma2 <- matrix(c(2, .5, .5,2),2,2) # covar matrix for the second cluster
X <- matrix(0, n, 15, dimnames = list(NULL, paste0("X", 1:15)))
set.seed(1234) # for replication
u <- runif(n)
Class <- ifelse(u < pro, 1, 2)

#Important variables
X[u < pro, 1:2]  <- MASS::mvrnorm(sum(u < pro), mu = mu1, Sigma = sigma1)
X[u >= pro, 1:2] <- MASS::mvrnorm(sum(u >= pro), mu = mu2, Sigma = sigma2)

#Irrelevant variables
X[, 3] <- rnorm(n)
X[, 4] <- rnorm(n, mean = 1.5, sd = 2)
X[, 5] <- rnorm(n, mean = 2, sd = 1)

#Irrelevant variables but introducing two clusters
X[, 6] <- c(rnorm(100, mean = 3, sd = 1), rnorm(100, mean = 10, sd = 1))
X[, 7] <- c(rnorm(100, mean = 3, sd = 1), rnorm(100, mean = 10, sd = 1))

#Linear combincations of irrelevant variabls
X[, 8] <- X[, 5] + rnorm(n, mean = -1, sd = 2.5)
X[, 9] <- X[, 3] + X[, 4] + rnorm(n, mean = -1, sd = 2.5)
X[, 10] <- X[, 3] + X[, 5] + rnorm(n, mean = -1, sd = 2.5)
X[, 11] <- X[, 4] + X[, 5] + rnorm(n, mean = -1, sd = 2.5)
X[, 12] <- X[, 3] + X[, 4] + X[, 4] + rnorm(n, mean = -1, sd = 2.5)

#Linear combincations of important variabls
X[, 13] <- X[,1] + rnorm(n)
X[, 14] <- X[,2] + rnorm(n)
X[, 15] <- X[,1] + X[,2] + rnorm(n)

plot(X[,c(1,2)], col = Class, pch = 19, main = "Important variables (X1 and X2)")

plot(X[,c(6,7)], col = c("green", "orange"), pch = 19, main = "Noise variable with grouping (X6 and X7)")


#sim_data = list.append(sim_data, X)


sim3 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim3.rds")
out = sim3 [[1]]
mod_vscc = sim3 [[2]]
permuted_data = sim3[[3]]
permute_ob_fn = sim3[[4]]


#Variable selection Clustvarsel
#out <- clustvarsel(X)
out$subset
tab = as.data.frame(prop.table(table(Class, out$model$classification)))
colnames(tab)[2] = "Group_Assigned"

#Variable selection VSCC
#mod_vscc = vscc(X, G=1:5, automate = "mclust", initial = NULL, train = NULL, forcereduction = FALSE)
colnames(head(mod_vscc$selected[[1]]))
mod_vscc$bestmodel$d
tab_vscc = as.data.frame(prop.table(table(Class, mod_vscc$bestmodel$classification)))


#Permutation feature selection 
#permuted_data  =  shuffle_fn(X, 10)
#permute_ob_fn = apply(permuted_data, 1, function(a){apply(a, 1, mclust_fn)})

apply(permute_ob_fn, 2, mean)
plot(apply(permute_ob_fn, 2, mean), main = "Mean likelihood after permutations for each variable")


saveRDS(list(out, mod_vscc, permuted_data, permute_ob_fn), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim3.rds")



```


```{r DataPrep_Sim4}
#Sim4: Dy_Brodley paper: 1 important variables, 1 unimportant variable, 3 noise variables, two clusters 

n <- 500      # sample size
pro <- 0.5    # mixing proportion
mu1 <- c(0,0) # mean vector for the first cluster
mu2 <- c(0,3) # mean vector for the second cluster
sigma1 <- diag(2)       # covar matrix for the first cluster
sigma2 <- diag(2) # covar matrix for the second cluster
X <- matrix(0, n, 5, dimnames = list(NULL, paste0("X", 1:5)))
set.seed(1234) # for replication
u <- runif(n)
Class <- ifelse(u < pro, 1, 2)

#Important variables
X[u < pro, 1:2]  <- MASS::mvrnorm(sum(u < pro), mu = mu1, Sigma = sigma1)
X[u >= pro, 1:2] <- MASS::mvrnorm(sum(u >= pro), mu = mu2, Sigma = sigma2)

#Irrelevant variables
#X[, 3] <- c(rnorm(20, 10, 3), rnorm(180, 20, 3)) #if this is not a mixture then the algo does not find it as important
X[, 3] <- rnorm(n)
X[, 4] <- rnorm(n, mean = 1.3, sd = 2.6)
X[, 5] <- rnorm(n, mean = -.3, sd = 1.1)

plot(X[,c(1,2)], col = Class, pch = 19, main = "Important variables (X1 and X2)")


#sim_data = list.append(sim_data, X)

# sim4 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim4.rds")
# out = sim4[[1]]
# mod_vscc = sim4[[2]]
# permuted_data = sim4[[3]]
# permute_ob_mclust = sim4[[4]]
# permute_ob_km = sim4[[5]]



#Variable selection Clustvarsel
out <- clustvarsel(X, G =2)
# out$subset
# tab = as.data.frame(prop.table(table(Class, out$model$classification)))
# colnames(tab)[2] = "Group_Assigned"

#Variable selection VSCC
mod_vscc = vscc(X, G=2, automate = "mclust", initial = NULL, train = NULL, forcereduction = FALSE)
# colnames(head(mod_vscc$selected[[1]]))
# mod_vscc$bestmodel$d
# tab_vscc = as.data.frame(prop.table(table(Class, mod_vscc$bestmodel$classification)))


#Permutation feature selection 
permuted_data  =  shuffle_fn(X, 50)
permute_ob_mclust = apply(permuted_data, 1, function(a){apply(a, 1, mclust_fn)})
permute_ob_km = apply(permuted_data, 1, function(a){apply(a, 1, kmeans_fn)})


apply(permute_ob_fn, 2, mean)
plot(apply(permute_ob_fn, 2, mean), main = "Mean likelihood after permutations for each variable")


saveRDS(list(out, mod_vscc, permuted_data, permute_ob_mclust, permute_ob_km), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim4.rds")




```


```{r DataPrep_Sim5}
#Sim5: Dy_Brodley paper: 2 important variables, 3 noise variable, three clusters: one covariance is orthogonal to other and the third cluster overlaps the tail end of right side of the ohter two clusters. 

mclust_fn <- function(data, G = 3, verbose = FALSE){
  mod_clust = Mclust(data, G = G)
  return(mod_clust$loglik)
}

kmeans_fn <- function(data, G = 3){
  mod = kmeans(data, centers = G)
  return(mod$tot.withinss)
}

n <- 500      # sample size
pro1 <- 0.333    # mixing proportion
pro2 <- 0.666    # mixing proportion

mu1 <- c(0,0) # mean vector for the first cluster
mu2 <- c(0,0) # mean vector for the second cluster
mu3 <- c(3,0) # mean vector for the second cluster

sigma1 <- matrix(c(2, 1.7, 1.7,2),2,2)       # covar matrix for the first cluster
sigma2 <- solve(t(sigma1)) # covar matrix for the second cluster
sigma3 <- matrix(c(.3, 0.2, 0.2,4),2,2)       # covar matrix for the first cluster


X <- matrix(0, n, 5, dimnames = list(NULL, paste0("X", 1:5)))
set.seed(1234) # for replication
u <- runif(n)
Class <- ifelse(u < pro1, 1, ifelse(u < pro2, 2, 3))

#Important variables
X[u < pro1, 1:2]  <- MASS::mvrnorm(sum(u < pro1), mu = mu1, Sigma = sigma1)
X[u >= pro1 & u < pro2, 1:2] <- MASS::mvrnorm(sum(u >= pro1 & u < pro2), mu = mu2, Sigma = sigma2)
X[u > pro2, 1:2] <- MASS::mvrnorm(sum(u > pro2), mu = mu3, Sigma = sigma3)


#Irrelevant variables
X[, 3] <- rnorm(n)
X[, 4] <- rnorm(n, mean = 1.3, sd = 2.6)
X[, 5] <- rnorm(n, mean = -.3, sd = 1.1)


plot(X[,c(1,2)], col = Class, pch = 19, main = "Important variables (X1 and X2)")
#sim_data = list.append(sim_data, X)

# sim5 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim5.rds")
# out = sim5[[1]]
# mod_vscc = sim5[[2]]
# permuted_data = sim5[[3]]
# permute_ob_mclust = sim5[[4]]
# permute_ob_km = sim5[[5]]


#Variable selection Clustvarsel
out <- clustvarsel(X, G = 3)
# out$subset
# tab = as.data.frame(prop.table(table(Class, out$model$classification)))
# colnames(tab)[2] = "Group_Assigned"

#Variable selection VSCC
mod_vscc = vscc(X, G=3, automate = "mclust", initial = NULL, train = NULL, forcereduction = FALSE)
# colnames(head(mod_vscc$selected[[1]]))
# mod_vscc$bestmodel$d
# tab_vscc = as.data.frame(prop.table(table(Class, mod_vscc$bestmodel$classification)))


#Permutation feature selection 
permuted_data  =  shuffle_fn(X, 50)
permute_ob_mclust = apply(permuted_data, 1, function(a){apply(a, 1, mclust_fn)})
permute_ob_km = apply(permuted_data, 1, function(a){apply(a, 1, kmeans_fn)})


apply(permute_ob_fn, 2, mean)
plot(apply(permute_ob_fn, 2, mean), main = "Mean likelihood after permutations for each variable")


saveRDS(list(out, mod_vscc, permuted_data, permute_ob_mclust, permute_ob_km), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim5.rds")





```


```{r DataPrep_Sim6}
#Sim6: Dy_Brodley paper: 2 important variables, 3 noise variable, three clusters: one covariance is orthogonal to other and the third cluster overlaps the tail end of right side of the ohter two clusters. 

mclust_fn <- function(data, G = 3, verbose = FALSE){
  mod_clust = Mclust(data, G = G)
  return(mod_clust$loglik)
}

n <- 500      # sample size
pro1 <- 0.25    # mixing proportion
pro2 <- 0.5    # mixing proportion
pro3 <- 0.75    # mixing proportion

mu1 <- c(0,0) # mean vector for the first cluster
mu2 <- c(1,4) # mean vector for the second cluster
mu3 <- c(5,5) # mean vector for the second cluster
mu4 <- c(5,0) # mean vector for the second cluster

sigma1 <- diag(2)       # covar matrix for the first cluster
sigma2 <- diag(2) # covar matrix for the second cluster
sigma3 <- diag(2)       # covar matrix for the first cluster
sigma4 <- diag(2)

X <- matrix(0, n, 5, dimnames = list(NULL, paste0("X", 1:5)))
set.seed(1234) # for replication
u <- runif(n)
Class <- ifelse(u < pro1, 1, ifelse(u < pro2, 2, ifelse(u<pro3, 3, 4)))

#Important variables
X[u < pro1, 1:2]  <- MASS::mvrnorm(sum(u < pro1), mu = mu1, Sigma = sigma1)
X[u >= pro1 & u < pro2, 1:2] <- MASS::mvrnorm(sum(u >= pro1 & u < pro2), mu = mu2, Sigma = sigma2)
X[u >= pro2 & u < pro3, 1:2] <- MASS::mvrnorm(sum(u >= pro2 & u < pro3), mu = mu3, Sigma = sigma3)
X[u >= pro3, 1:2] <- MASS::mvrnorm(sum(u >= pro3), mu = mu4, Sigma = sigma4)


#Irrelevant variables
X[, 3] <- rnorm(n)
X[, 4] <- rnorm(n, mean = 1.3, sd = 2.6)
X[, 5] <- rnorm(n, mean = -.3, sd = 1.1)


plot(X[,c(1,2)], col = Class, pch = 19, main = "Important variables (X1 and X2)")
#sim_data = list.append(sim_data, X)

# sim6 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim6.rds")
# out = sim6[[1]]
# mod_vscc = sim6[[2]]
# permuted_data = sim6[[3]]
# permute_ob_mclust = sim6[[4]]
# permute_ob_km = sim6[[5]]


#Variable selection Clustvarsel
out <- clustvarsel(X, G =3)
# out$subset
# tab = as.data.frame(prop.table(table(Class, out$model$classification)))
# colnames(tab)[2] = "Group_Assigned"

#Variable selection VSCC
mod_vscc = vscc(X, G=3, automate = "mclust", initial = NULL, train = NULL, forcereduction = FALSE)
# colnames(head(mod_vscc$selected[[1]]))
# mod_vscc$bestmodel$d
# tab_vscc = as.data.frame(prop.table(table(Class, mod_vscc$bestmodel$classification)))


#Permutation feature selection 
permuted_data  =  shuffle_fn(X, 50)
permute_ob_mclust = apply(permuted_data, 1, function(a){apply(a, 1, mclust_fn)})
permute_ob_km = apply(permuted_data, 1, function(a){apply(a, 1, kmeans_fn)})


apply(permute_ob_mclust, 2, mean)
apply(permute_ob_km, 2, mean)
plot(apply(permute_ob_mclust, 2, mean), main = "Mean likelihood after permutations for each variable")
plot(apply(permute_ob_km, 2, mean), main = "Mean likelihood after permutations for each variable")

saveRDS(list(out, mod_vscc, permuted_data, permute_ob_mclust, permute_ob_km), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim6.rds")


```

```{r}
library(rlist)
library(clustvarsel)
library(vscc)
#library(purrr)
sim_data = list()

shuffle_fn <- function(data, permute_no){
  n = nrow(data)
  d = ncol(data)
  shuff_data = array(NA, dim = c(d, permute_no, n, d))
  for (i in 1:d){
    for (perm in 1:permute_no){
      s_data = cbind(data[ , -i], sample(data[,i]))
      shuff_data[ i, perm, , ] = s_data
    } 
  }
  return(shuff_data)
}

mclust_fn <- function(data, G = 2, verbose = FALSE){
  mod_clust = Mclust(data, G = G)
  return(mod_clust$loglik)
}
```



```{r sim7}
#Sim7: Three important variables; three clusters; trying to break vscc!
mclust_fn_3 = function(data){mclust_fn(data, G=3, verbose = FALSE)}

select_var_fn <- function(data, G, permute_no){
  vscc_model = vscc(data, G = G)
  vscc_top_var = colnames(vscc_model$topselected)
  vscc_select1_var = colnames(vscc_model$selected[[1]])
  vscc_select2_var = colnames(vscc_model$selected[[2]])
  vscc_select3_var = colnames(vscc_model$selected[[3]])
  vscc_select4_var = colnames(vscc_model$selected[[4]])
  vscc_select5_var = colnames(vscc_model$selected[[5]])
  clust_model = clustvarsel(data, G = G, verbose = FALSE)
  clust_top_var = clust_model$variables
  permuted_data  =  shuffle_fn(data, permute_no)
  permute_ob_fn = apply(permuted_data, 1, function(a){apply(a, 1, mclust_fn_3)})
  loglik_permuted = apply(permute_ob_fn, 2, mean)
  mcl = Mclust(data, G = G)$loglik
  return(list(vscc_top_var, vscc_select1_var, vscc_select2_var, vscc_select3_var, vscc_select4_var, vscc_select5_var, clust_top_var, loglik_permuted, mcl))
}

data_gen <- function(k, rho, n1, n2, n3, noise_no){
  seqk  = rep(5,k)
  sigma0 = (1-rho)*diag(k) + rho
  n = n1 + n2 + n3
  y1    = MASS::mvrnorm(n1, mu = c(seqk[1:2], seqk[-c(1,2)]), Sigma = sigma0)
  y2    = MASS::mvrnorm(n2, mu = rep(0,k), Sigma = sigma0)
  y3    = MASS::mvrnorm(n3, mu = c(0, 0, 0.3*seqk[-c(1,2)]), Sigma = sigma0)
  datay = rbind(y1,y2,y3)
  
  if (noise_no > 1){
    mu_noise = rnorm(noise_no, 0, 2)
    sigma_noise = rchisq(noise_no, 1)
    noise =  MASS::mvrnorm(n, mu = mu_noise, Sigma = diag(sigma_noise))
    datay = cbind(datay, noise)
    colnames(datay) = paste0("X", 1:ncol(datay))
    return(datay)
  } else if (noise_no != 0) {
    mu_noise = rnorm(noise_no, 0, 2)
    sigma_noise = rchisq(noise_no, 1)
    noise =  rnorm(n, mean = mu_noise, sd = sigma_noise)
    datay = cbind(datay, noise)
    colnames(datay) = paste0("X", 1:ncol(datay))
    return(datay)

  } else {
    colnames(datay) = paste0("X", 1:ncol(datay))
    return(datay)
  }
}

sort_fn = function(a){
  return(names(sort(a, decreasing  = FALSE)))
}

top_fn_permute = function(data){
  colnames(data) = paste0("X", 1:ncol(data))
  temp = apply(data, 1, sort_fn)
  return(temp)
}


b = 100
#data = datay
G= 3
permute_no = 30
k = 3
rho = .9
n1 = 100
n2 = 50
n3 = 50
noise_no = 0 #no. of noise variables
p = 3 #no. of important variables


vscc_top_var_all = c()
vscc_select1_var_all = c()
vscc_select2_var_all = c()
vscc_select3_var_all = c()
vscc_select4_var_all = c()
vscc_select5_var_all = c()
clust_top_var_all = c()
loglik_permuted = matrix(0, b, p + noise_no)
mcl_all = c()

# for (j in 1:b){
#     sim_data = data_gen(k, rho, n1, n2, n3, noise_no)
#     select_var = select_var_fn(data = sim_data, G = G, permute_no = permute_no)
# 
#     vscc_top_var_all = c(vscc_top_var_all, select_var[[1]])
#     vscc_select1_var_all = c(vscc_select1_var_all, select_var[[2]])
#     vscc_select2_var_all = c(vscc_select2_var_all, select_var[[3]])
#     vscc_select3_var_all = c(vscc_select3_var_all, select_var[[4]])
#     vscc_select4_var_all = c(vscc_select4_var_all, select_var[[5]])
#     vscc_select5_var_all = c(vscc_select5_var_all, select_var[[6]])
#     clust_top_var_all = c(clust_top_var_all, select_var[[7]])
#     loglik_permuted[j, ] = select_var[[8]]
#     mcl_all = c(mcl_all, select_var[[9]])
#   }

sim7 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim7.rds")
vscc_top_var_all = sim7[[1]]
vscc_select1_var_all = sim7[[2]]
vscc_select2_var_all = sim7[[3]]
vscc_select3_var_all = sim7[[4]]
vscc_select4_var_all = sim7[[5]]
vscc_select5_var_all = sim7[[6]]
clust_top_var_all = sim7[[7]]
loglik_permuted = sim7[[8]]
mcl_all = sim7[[9]]


#table(vscc_select1_var_all)
#table(vscc_select2_var_all)
#table(vscc_select3_var_all)
#table(vscc_select4_var_all)
#table(vscc_select5_var_all)


temp = top_fn_permute(loglik_permuted)

#Top VSCC
table(vscc_top_var_all) 
#Clustvarsel
table(clust_top_var_all)
#Permute: Number of times X1, X2, X3 appeared in top3
table(temp[1:3,]) 



#loglik_permuted_sorted = t(apply(loglik_permuted, 1, function(a){return(sort(a,  decreasing = FALSE))}))

m_loglik = apply(loglik_permuted, 2, mean)
names(m_loglik) = paste0("X", 1:ncol(loglik_permuted))
#mean_loglik = apply(loglik_permuted, 2, mean)
plot(m_loglik, xlab = "Variable", ylab = "Mean Log-likelihood", pch = 19, xaxt="n", col = "red")
axis(1, at = seq(1, length(m_loglik), 1), labels = names(m_loglik))




# saveRDS(list(vscc_top_var_all, vscc_select1_var_all, vscc_select2_var_all, vscc_select3_var_all, vscc_select4_var_all, vscc_select5_var_all, clust_top_var_all, loglik_permuted, mcl_all), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim7.rds")


```

```{r sim8, message=FALSE, warning=FALSE}
#Sim8: Adding one more noise variable to sim7
noise_no = 1 #no. of noise variables


vscc_top_var_all = c()
vscc_select1_var_all = c()
vscc_select2_var_all = c()
vscc_select3_var_all = c()
vscc_select4_var_all = c()
vscc_select5_var_all = c()
clust_top_var_all = c()
loglik_permuted = matrix(0, b, p + noise_no)
mcl_all = c()
# 
# for (j in 1:b){
#     sim_data = data_gen(k, rho, n1, n2, n3, noise_no)
#     select_var = select_var_fn(data = sim_data, G = G, permute_no = permute_no)
# 
#     vscc_top_var_all = c(vscc_top_var_all, select_var[[1]])
#     vscc_select1_var_all = c(vscc_select1_var_all, select_var[[2]])
#     vscc_select2_var_all = c(vscc_select2_var_all, select_var[[3]])
#     vscc_select3_var_all = c(vscc_select3_var_all, select_var[[4]])
#     vscc_select4_var_all = c(vscc_select4_var_all, select_var[[5]])
#     vscc_select5_var_all = c(vscc_select5_var_all, select_var[[6]])
#     clust_top_var_all = c(clust_top_var_all, select_var[[7]])
#     loglik_permuted[j, ] = select_var[[8]]
#     mcl_all = c(mcl_all, select_var[[9]])
#   }

sim8 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim8.rds")
vscc_top_var_all = sim8[[1]]
vscc_select1_var_all = sim8[[2]]
vscc_select2_var_all = sim8[[3]]
vscc_select3_var_all = sim8[[4]]
vscc_select4_var_all = sim8[[5]]
vscc_select5_var_all = sim8[[6]]
clust_top_var_all = sim8[[7]]
loglik_permuted = sim8[[8]]
mcl_all = sim8[[9]]

#table(vscc_select1_var_all)
#table(vscc_select2_var_all)
#table(vscc_select3_var_all)
#table(vscc_select4_var_all)
#table(vscc_select5_var_all)


temp = top_fn_permute(loglik_permuted)

#Top VSCC
table(vscc_top_var_all) 
#Clustvarsel
table(clust_top_var_all)
#Permute: Number of times X1, X2, X3 appeared in top3
table(temp[1:3,]) 



#loglik_permuted_sorted = t(apply(loglik_permuted, 1, function(a){return(sort(a,  decreasing = FALSE))}))

m_loglik = apply(loglik_permuted, 2, mean)
names(m_loglik) = paste0("X", 1:ncol(loglik_permuted))
#mean_loglik = apply(loglik_permuted, 2, mean)
plot(m_loglik, xlab = "Variable", ylab = "Mean Log-likelihood", pch = 19, xaxt="n", col = "red")
axis(1, at = seq(1, length(m_loglik), 1), labels = names(m_loglik))



# saveRDS(list(vscc_top_var_all, vscc_select1_var_all, vscc_select2_var_all, vscc_select3_var_all, vscc_select4_var_all, vscc_select5_var_all, clust_top_var_all, loglik_permuted, mcl_all), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim8.rds")
```

```{r sim9, message=FALSE, warning=FALSE}
#Sim9: Adding 2 more noise variable to sim7
noise_no = 2 #no. of noise variables


vscc_top_var_all = c()
vscc_select1_var_all = c()
vscc_select2_var_all = c()
vscc_select3_var_all = c()
vscc_select4_var_all = c()
vscc_select5_var_all = c()
clust_top_var_all = c()
loglik_permuted = matrix(0, b, p + noise_no)
mcl_all = c()

# for (j in 1:b){
#     sim_data = data_gen(k, rho, n1, n2, n3, noise_no)
#     select_var = select_var_fn(data = sim_data, G = G, permute_no = permute_no)
# 
#     vscc_top_var_all = c(vscc_top_var_all, select_var[[1]])
#     vscc_select1_var_all = c(vscc_select1_var_all, select_var[[2]])
#     vscc_select2_var_all = c(vscc_select2_var_all, select_var[[3]])
#     vscc_select3_var_all = c(vscc_select3_var_all, select_var[[4]])
#     vscc_select4_var_all = c(vscc_select4_var_all, select_var[[5]])
#     vscc_select5_var_all = c(vscc_select5_var_all, select_var[[6]])
#     clust_top_var_all = c(clust_top_var_all, select_var[[7]])
#     loglik_permuted[j, ] = select_var[[8]]
#     mcl_all = c(mcl_all, select_var[[9]])
#   }

sim9 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim9.rds")
vscc_top_var_all = sim9[[1]]
vscc_select1_var_all = sim9[[2]]
vscc_select2_var_all = sim9[[3]]
vscc_select3_var_all = sim9[[4]]
vscc_select4_var_all = sim9[[5]]
vscc_select5_var_all = sim9[[6]]
clust_top_var_all = sim9[[7]]
loglik_permuted = sim9[[8]]
mcl_all = sim9[[9]]

#table(vscc_select1_var_all)
#table(vscc_select2_var_all)
#table(vscc_select3_var_all)
#table(vscc_select4_var_all)
#table(vscc_select5_var_all)


temp = top_fn_permute(loglik_permuted)

#Top VSCC
table(vscc_top_var_all) 
#Clustvarsel
table(clust_top_var_all)
#Permute: Number of times X1, X2, X3 appeared in top3
table(temp[1:3,]) 



#loglik_permuted_sorted = t(apply(loglik_permuted, 1, function(a){return(sort(a,  decreasing = FALSE))}))

m_loglik = apply(loglik_permuted, 2, mean)
names(m_loglik) = paste0("X", 1:ncol(loglik_permuted))
#mean_loglik = apply(loglik_permuted, 2, mean)
plot(m_loglik, xlab = "Variable", ylab = "Mean Log-likelihood", pch = 19, xaxt="n", col = "red")
axis(1, at = seq(1, length(m_loglik), 1), labels = names(m_loglik))


# saveRDS(list(vscc_top_var_all, vscc_select1_var_all, vscc_select2_var_all, vscc_select3_var_all, vscc_select4_var_all, vscc_select5_var_all, clust_top_var_all, loglik_permuted, mcl_all), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim9.rds")
```

```{r Sim10}

#Sim10: Adding 3 more noise variable to sim7
noise_no = 3 #no. of noise variables


vscc_top_var_all = c()
vscc_select1_var_all = c()
vscc_select2_var_all = c()
vscc_select3_var_all = c()
vscc_select4_var_all = c()
vscc_select5_var_all = c()
clust_top_var_all = c()
loglik_permuted = matrix(0, b, p + noise_no)
mcl_all = c()

# for (j in 1:b){
#     sim_data = data_gen(k, rho, n1, n2, n3, noise_no)
#     select_var = select_var_fn(data = sim_data, G = G, permute_no = permute_no)
# 
#     vscc_top_var_all = c(vscc_top_var_all, select_var[[1]])
#     vscc_select1_var_all = c(vscc_select1_var_all, select_var[[2]])
#     vscc_select2_var_all = c(vscc_select2_var_all, select_var[[3]])
#     vscc_select3_var_all = c(vscc_select3_var_all, select_var[[4]])
#     vscc_select4_var_all = c(vscc_select4_var_all, select_var[[5]])
#     vscc_select5_var_all = c(vscc_select5_var_all, select_var[[6]])
#     clust_top_var_all = c(clust_top_var_all, select_var[[7]])
#     loglik_permuted[j, ] = select_var[[8]]
#     mcl_all = c(mcl_all, select_var[[9]])
#   }

sim10 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim10.rds")
vscc_top_var_all = sim10[[1]]
vscc_select1_var_all = sim10[[2]]
vscc_select2_var_all = sim10[[3]]
vscc_select3_var_all = sim10[[4]]
vscc_select4_var_all = sim10[[5]]
vscc_select5_var_all = sim10[[6]]
clust_top_var_all = sim10[[7]]
loglik_permuted = sim10[[8]]
mcl_all = sim10[[9]]


#table(vscc_select1_var_all)
#table(vscc_select2_var_all)
#table(vscc_select3_var_all)
#table(vscc_select4_var_all)
#table(vscc_select5_var_all)

temp = top_fn_permute(loglik_permuted)

#Top VSCC
table(vscc_top_var_all) 
#Clustvarsel
table(clust_top_var_all)
#Permute: Number of times X1, X2, X3 appeared in top3
table(temp[1:3,]) 



#loglik_permuted_sorted = t(apply(loglik_permuted, 1, function(a){return(sort(a,  decreasing = FALSE))}))

m_loglik = apply(loglik_permuted, 2, mean)
names(m_loglik) = paste0("X", 1:ncol(loglik_permuted))
#mean_loglik = apply(loglik_permuted, 2, mean)
plot(m_loglik, xlab = "Variable", ylab = "Mean Log-likelihood", pch = 19, xaxt="n", col = "red")
axis(1, at = seq(1, length(m_loglik), 1), labels = names(m_loglik))


# saveRDS(list(vscc_top_var_all, vscc_select1_var_all, vscc_select2_var_all, vscc_select3_var_all, vscc_select4_var_all, vscc_select5_var_all, clust_top_var_all, loglik_permuted, mcl_all), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim10.rds")
```

```{r sim11}
#Sim11: Adding 4 more noise variables to sim7
noise_no = 4 #no. of noise variables


vscc_top_var_all = c()
vscc_select1_var_all = c()
vscc_select2_var_all = c()
vscc_select3_var_all = c()
vscc_select4_var_all = c()
vscc_select5_var_all = c()
clust_top_var_all = c()
loglik_permuted = matrix(0, b, p + noise_no) 
mcl_all = c()

# for (j in 1:b){
#     sim_data = data_gen(k, rho, n1, n2, n3, noise_no)
#     select_var = select_var_fn(data = sim_data, G = G, permute_no = permute_no)
# 
#     vscc_top_var_all = c(vscc_top_var_all, select_var[[1]])
#     vscc_select1_var_all = c(vscc_select1_var_all, select_var[[2]])
#     vscc_select2_var_all = c(vscc_select2_var_all, select_var[[3]])
#     vscc_select3_var_all = c(vscc_select3_var_all, select_var[[4]])
#     vscc_select4_var_all = c(vscc_select4_var_all, select_var[[5]])
#     vscc_select5_var_all = c(vscc_select5_var_all, select_var[[6]])
#     clust_top_var_all = c(clust_top_var_all, select_var[[7]])
#     loglik_permuted[j, ] = select_var[[8]]
#     mcl_all = c(mcl_all, select_var[[9]])
#   }

sim11 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim11.rds")
vscc_top_var_all = sim11[[1]]
vscc_select1_var_all = sim11[[2]]
vscc_select2_var_all = sim11[[3]]
vscc_select3_var_all = sim11[[4]]
vscc_select4_var_all = sim11[[5]]
vscc_select5_var_all = sim11[[6]]
clust_top_var_all = sim11[[7]]
loglik_permuted = sim11[[8]]
mcl_all = sim11[[9]]


#table(vscc_select1_var_all)
#table(vscc_select2_var_all)
#table(vscc_select3_var_all)
#table(vscc_select4_var_all)
#table(vscc_select5_var_all)


temp = top_fn_permute(loglik_permuted)

#Top VSCC
table(vscc_top_var_all) 
#Clustvarsel
table(clust_top_var_all)
#Permute: Number of times X1, X2, X3 appeared in top3
table(temp[1:3,]) 



#loglik_permuted_sorted = t(apply(loglik_permuted, 1, function(a){return(sort(a,  decreasing = FALSE))}))

m_loglik = apply(loglik_permuted, 2, mean)
names(m_loglik) = paste0("X", 1:ncol(loglik_permuted))
#mean_loglik = apply(loglik_permuted, 2, mean)
plot(m_loglik, xlab = "Variable", ylab = "Mean Log-likelihood", pch = 19, xaxt="n", col = "red")
axis(1, at = seq(1, length(m_loglik), 1), labels = names(m_loglik))



# saveRDS(list(vscc_top_var_all, vscc_select1_var_all, vscc_select2_var_all, vscc_select3_var_all, vscc_select4_var_all, vscc_select5_var_all, clust_top_var_all, loglik_permuted, mcl_all), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim11.rds")
```


```{r sim12}
#Sim12: Adding 5 more noise variables to sim7
noise_no = 5 #no. of noise variables


vscc_top_var_all = c()
vscc_select1_var_all = c()
vscc_select2_var_all = c()
vscc_select3_var_all = c()
vscc_select4_var_all = c()
vscc_select5_var_all = c()
clust_top_var_all = c()
loglik_permuted = matrix(0, b, p + noise_no) 
mcl_all = c()

# for (j in 1:b){
#     sim_data = data_gen(k, rho, n1, n2, n3, noise_no)
#     select_var = select_var_fn(data = sim_data, G = G, permute_no = permute_no)
# 
#     vscc_top_var_all = c(vscc_top_var_all, select_var[[1]])
#     vscc_select1_var_all = c(vscc_select1_var_all, select_var[[2]])
#     vscc_select2_var_all = c(vscc_select2_var_all, select_var[[3]])
#     vscc_select3_var_all = c(vscc_select3_var_all, select_var[[4]])
#     vscc_select4_var_all = c(vscc_select4_var_all, select_var[[5]])
#     vscc_select5_var_all = c(vscc_select5_var_all, select_var[[6]])
#     clust_top_var_all = c(clust_top_var_all, select_var[[7]])
#     loglik_permuted[j, ] = select_var[[8]]
#     mcl_all = c(mcl_all, select_var[[9]])
#   }

sim12 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim12.rds")
vscc_top_var_all = sim12[[1]]
vscc_select1_var_all = sim12[[2]]
vscc_select2_var_all = sim12[[3]]
vscc_select3_var_all = sim12[[4]]
vscc_select4_var_all = sim12[[5]]
vscc_select5_var_all = sim12[[6]]
clust_top_var_all = sim12[[7]]
loglik_permuted = sim12[[8]]
mcl_all = sim12[[9]]


#table(vscc_select1_var_all)
#table(vscc_select2_var_all)
#table(vscc_select3_var_all)
#table(vscc_select4_var_all)
#table(vscc_select5_var_all)


temp = top_fn_permute(loglik_permuted)

#Top VSCC
table(vscc_top_var_all) 
#Clustvarsel
table(clust_top_var_all)
#Permute: Number of times X1, X2, X3 appeared in top3
table(temp[1:3,]) 



#loglik_permuted_sorted = t(apply(loglik_permuted, 1, function(a){return(sort(a,  decreasing = FALSE))}))

m_loglik = apply(loglik_permuted, 2, mean)
names(m_loglik) = paste0("X", 1:ncol(loglik_permuted))
#mean_loglik = apply(loglik_permuted, 2, mean)
plot(m_loglik, xlab = "Variable", ylab = "Mean Log-likelihood", pch = 19, xaxt="n", col = "red")
axis(1, at = seq(1, length(m_loglik), 1), labels = names(m_loglik))
# saveRDS(list(vscc_top_var_all, vscc_select1_var_all, vscc_select2_var_all, vscc_select3_var_all, vscc_select4_var_all, vscc_select5_var_all, clust_top_var_all, loglik_permuted, mcl_all), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim12.rds")
```























```{r Sim15}
#Sim15: Adding 40 more noise variable to sim7
noise_no = 40 #no. of noise variables


vscc_top_var_all = c()
vscc_select1_var_all = c()
vscc_select2_var_all = c()
vscc_select3_var_all = c()
vscc_select4_var_all = c()
vscc_select5_var_all = c()
clust_top_var_all = c()
loglik_permuted = matrix(0, b, p + noise_no)
mcl_all = c()

for (j in 1:b){
    sim_data = data_gen(k, rho, n1, n2, n3, noise_no)
    select_var = select_var_fn(data = sim_data, G = G, permute_no = permute_no)

    vscc_top_var_all = c(vscc_top_var_all, select_var[[1]])
    vscc_select1_var_all = c(vscc_select1_var_all, select_var[[2]])
    vscc_select2_var_all = c(vscc_select2_var_all, select_var[[3]])
    vscc_select3_var_all = c(vscc_select3_var_all, select_var[[4]])
    vscc_select4_var_all = c(vscc_select4_var_all, select_var[[5]])
    vscc_select5_var_all = c(vscc_select5_var_all, select_var[[6]])
    clust_top_var_all = c(clust_top_var_all, select_var[[7]])
    loglik_permuted[j, ] = select_var[[8]]
    mcl_all = c(mcl_all, select_var[[9]])
  }

# sim15 = readRDS(file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim15.rds")
# vscc_top_var_all = sim15[[1]]
# vscc_select1_var_all = sim15[[2]]
# vscc_select2_var_all = sim15[[3]]
# vscc_select3_var_all = sim15[[4]]
# vscc_select4_var_all = sim15[[5]]
# vscc_select5_var_all = sim15[[6]]
# clust_top_var_all = sim15[[7]]
# loglik_permuted = sim15[[8]]
# mcl_all = sim15[[9]]


saveRDS(list(vscc_top_var_all, vscc_select1_var_all, vscc_select2_var_all, vscc_select3_var_all, vscc_select4_var_all, vscc_select5_var_all, clust_top_var_all, loglik_permuted, mcl_all), file = "C:\\Maruf\\UWaterloo\\Research Essay\\Clusters\\Outputs\\sim15.rds")
```



```{r}
b = 100
#data = datay
G= 3
permute_no = 30
k = 3
rho = .9
n1 = 100
n2 = 50
n3 = 50
noise_no = 0 #no. of noise variables
p = 3 #no. of important variables


seqk  = rep(5,k)
sigma0 = (1-rho)*diag(k) + rho
n = n1 + n2 + n3
y1    = MASS::mvrnorm(n1, mu = c(seqk[1:2], seqk[-c(1,2)]), Sigma = sigma0)
y2    = MASS::mvrnorm(n2, mu = rep(0,k), Sigma = sigma0)
y3    = MASS::mvrnorm(n3, mu = c(0, 0, 0.3*seqk[-c(1,2)]), Sigma = sigma0)
datay = rbind(y1,y2,y3)
colnames(datay) = paste0("X", 1:3)

noise1 = rnorm(n, 0, 1)
noise2 = rnorm(n, 0, 1)
noise3 = rnorm(n, 0, 1)
noise4 = rnorm(n, 0, 1)

datay_noise = cbind(datay, noise1, noise2, noise3, noise4)


model_cvs = clustvarsel(datay_noise)
model_cvs$variables
```

